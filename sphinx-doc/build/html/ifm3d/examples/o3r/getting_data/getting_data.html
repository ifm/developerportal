<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to: receive an image &mdash; O3R  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> O3R
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation/O3R/README.html">O3R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/sphinx/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/sphinx/content/installation_instructions.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/sphinx/cli_link.html">Command Line tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/sphinx/python_api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/sphinx/cpp_api/annotated.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/sphinx/index.html">Indices and tables</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">O3R</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>How to: receive an image</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/ifm3d/examples/o3r/getting_data/getting_data.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-receive-an-image">
<h1>How to: receive an image<a class="headerlink" href="#how-to-receive-an-image" title="Permalink to this headline"></a></h1>
<p>A primary objective of <code class="docutils literal notranslate"><span class="pre">ifm3d</span></code> is to make it as simple and performant as possible to acquire pixel data from an ifm 3D camera.
Additionally, those data should be encoded in a useful format for performing computer vision and/or robotics perception tasks.
A typical <code class="docutils literal notranslate"><span class="pre">ifm3d</span></code> client program will follow the structure of a control loop whereby images are continuously acquired from the camera and acted upon in some application-specific way.</p>
<p>At the end of this ‘how to’, you should be able to receive images and know the basic usage of the <code class="docutils literal notranslate"><span class="pre">O3RCamera</span></code>, <code class="docutils literal notranslate"><span class="pre">FrameGrabber</span></code> and <code class="docutils literal notranslate"><span class="pre">StlImageBuffer</span></code> classes.</p>
<blockquote>
<div><p>Note: for O3D or O3X devices, simply use the <code class="docutils literal notranslate"><span class="pre">Camera</span></code> class in place of the <code class="docutils literal notranslate"><span class="pre">O3RCamera</span></code> in the following code.</p>
</div></blockquote>
<section id="o3rcamera-framegrabber-and-stlimagebuffer">
<h2>O3RCamera, FrameGrabber and StlImageBuffer<a class="headerlink" href="#o3rcamera-framegrabber-and-stlimagebuffer" title="Permalink to this headline"></a></h2>
<p>ifm3d provides three main classes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">O3RCamera</span></code> holds the configuration of the camera heads, handles the connection, etc;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FrameGrabber</span></code> receives frames (images);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">StlImageBuffer</span></code> stores the image data.</p></li>
</ul>
<p>Instantiating these objects is as follows:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">O3RCamera</span></code> class, counter-intuitively, refers to the computing unit (the VPU). It inherits its name from previous ifm 3D devices that only used one camera, with no distinction between sensing and computing units.
You can input:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ip</span></code>: the IP address of the device;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xmlrpc_port</span></code>: the XML_RPC port (it is fixed at the moment);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code>: the password to connect to the device (unused for the O3R).</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">FrameGrabber</span></code> stores a reference to the passed in camera shared pointer and starts a worker thread to stream in pixel data from the device.
Its inputs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cam</span></code>: The camera instance (the image processing platform) that handles the connection the the camera heads;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code>: A bitmask encoding the image acquisition schema to stream in from the camera;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: Port number of the camera head to grab data from (not the physical port number);</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">StlImageBuffer</span></code> class simply serves to store the received data. It allocates space for each individual image.</p>
<blockquote>
<div><p>Note: instantiating the objects is done the same way for any imager type (2D, 3D, different resolutions, etc).</p>
</div></blockquote>
<p>Note that <code class="docutils literal notranslate"><span class="pre">ifm3d</span></code> encourages the use of <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> as a means to manage the ownership and lifetimes of the core actors in an <code class="docutils literal notranslate"><span class="pre">ifm3d</span></code> program.
Indeed, you will notice that there is no need to explicitly allocate and deallocate memory.
To instantiate the <code class="docutils literal notranslate"><span class="pre">ifm3d::O3RCamera</span></code> object (or <code class="docutils literal notranslate"><span class="pre">ifm3d::Camera</span></code>), a call to <code class="docutils literal notranslate"><span class="pre">ifm3d::O3RCamera::MakeShared()</span></code> is made (or <code class="docutils literal notranslate"><span class="pre">ifm3d::Camera::MakeShared()</span></code>), rather than calling <code class="docutils literal notranslate"><span class="pre">std::make_shared</span></code> directly.
This wrapper function is used to handle direct hardware probing to determine the type of camera that is connected.
For example, this may be an O3R, O3D303, O3X, or something else. Regardless, a <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> is returned from this call.</p>
</section>
<section id="receive-an-image">
<h2>Receive an image<a class="headerlink" href="#receive-an-image" title="Permalink to this headline"></a></h2>
<p>You just need to call the <code class="docutils literal notranslate"><span class="pre">WaitForFrame</span></code> function. Input an <code class="docutils literal notranslate"><span class="pre">ImageBuffer</span></code> object as well as a timeout value in ms. Make sure the camera head is in “RUN” mode.</p>
<p>And you’re good to go! Now you can do something with all this data.</p>
<blockquote>
<div><p>Note :
The <code class="docutils literal notranslate"><span class="pre">WaitForFrame</span></code> method is called on our <code class="docutils literal notranslate"><span class="pre">ifm3d::FrameGrabber</span></code> pointer.
It is passed the <em>raw</em> pointer to the <code class="docutils literal notranslate"><span class="pre">ifm3d::ImageBuffer</span></code> and a timeout in milliseconds.
If a new frame from the camera cannot be acquired within the timeout, <code class="docutils literal notranslate"><span class="pre">WaitForFrame</span></code> will return false.
For the curious, we pass the raw pointer to the <code class="docutils literal notranslate"><span class="pre">ImageBuffer</span></code> as opposed to the smart pointer because it is more performant (the <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> reference count does not need to be incremented and decremented with every call to <code class="docutils literal notranslate"><span class="pre">WaitForFrame</span></code> and, semantically, the <code class="docutils literal notranslate"><span class="pre">FrameGrabber</span></code> via the <code class="docutils literal notranslate"><span class="pre">WaitForFrame</span></code> call does not participate in the ownership of the <code class="docutils literal notranslate"><span class="pre">ImageBuffer</span></code>).</p>
</div></blockquote>
</section>
<section id="access-the-data">
<h2>Access the data<a class="headerlink" href="#access-the-data" title="Permalink to this headline"></a></h2>
<p>Accessing the received data is done through the <code class="docutils literal notranslate"><span class="pre">StlImageBuffer</span></code>. Different data types are available depending on whether the camera is a 2D or a 3D camera. Simply access the image like so:</p>
</section>
<section id="the-full-example">
<h2>The full example<a class="headerlink" href="#the-full-example" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, ifm CSR.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>