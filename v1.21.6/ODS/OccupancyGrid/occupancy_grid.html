<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Occupancy grids &mdash; O3R  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=5800d392" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=d9f55abb"></script>
        <script src="../../_static/js/versionwarning.js?v=d4224a34"></script>
        <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ODS data recording strategies" href="../Recording/ods_data_recording.html" />
    <link rel="prev" title="Zones" href="../Zones/zones.html" />
    <!-- Google tag (gtag.js) -->
    <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZZ08KXKV1G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZZ08KXKV1G');
    </script> -->
     

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            O3R
          </a>
              <div class="version">
                v1.21.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GettingStarted/index_getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Firmware/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CompatibilityMatrix/compatibility_matrix.html">Compatibility Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Technology/index_technology.html">Technology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index_software_interfaces.html">Software Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CalibrationRoutines/index_calibrations.html">Calibration Routines</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index_ods.html">ODS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index_ods.html">The ODS journey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Mounting/mounting.html">Mounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Instantiation/instantiation.html">Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Configuration/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Presets/presets.html">Presets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Zones/zones.html">Zones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Presets/presets.html">Presets</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Occupancy grid</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#occupancy-grid">Occupancy grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#polar-occupancy-grid">Polar occupancy grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#range-of-interest">Range of Interest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ods-application-outputs">ODS application outputs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#transformcellcentertouser-transformation-parameters">transformCellCenterToUser - transformation parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Recording/ods_data_recording.html">Recording</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangingViews/changing_views.html">Changing views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../OverhangingLoads/overhanging_loads.html">Overhanging loads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../NegativeObstacles/negative_obstacles.html">Negative obstacles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DustMitigation/dust_mitigation.html">Dust artifact mitigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Interference/cross-talk.html">Interference mitigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ExtrinsicCalibration/index_extrinsic_calibration.html">Extrinsic calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Decalibration/decalibration_feature.html">Decalibration detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Performance/index_performance.html">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../DeviceVerification/index_device_verification.html">Device verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iVA/index_ifmODS_iVA.html">ifmVisionAssistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Python/index_ifmODS_python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cpp/index_ifmODS_cpp.html">C++</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS/index_pds.html">PDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PLC/index_plc.html">PLC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../downloadable/index.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">O3R</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index_ods.html">ODS (Obstacle Detection System)</a></li>
      <li class="breadcrumb-item active">Occupancy grids</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/ODS/OccupancyGrid/occupancy_grid.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="occupancy-grids">
<h1>Occupancy grids<a class="headerlink" href="#occupancy-grids" title="Link to this heading"></a></h1>
<section id="occupancy-grid">
<h2>Occupancy grid<a class="headerlink" href="#occupancy-grid" title="Link to this heading"></a></h2>
<p>The occupancy grid is a 2D grid-based representation of the environment, generated by post processing the depth data. Each grid cell contains a probability value indicating the likelihood of occupancy, encoded as an 8-bit unsigned integer (uint8):</p>
<ul class="simple">
<li><p>0 (uint8) → Probability 0.0 (free space)</p></li>
<li><p>255 (uint8) → Probability 1.0 (fully occupied)</p></li>
<li><p>Values between 0 and 255 represent intermediate occupancy probabilities. We recommend using a probability threshold of 0.5 (127) to assess whether a cell is occupied or not.</p></li>
</ul>
<!-- TODO: ADD IMAGE OF OCCUPANCY GRID -->
</section>
<section id="polar-occupancy-grid">
<h2>Polar occupancy grid<a class="headerlink" href="#polar-occupancy-grid" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>From the firmware versions &gt;= 1.20.29 the user can also able to retrieve the polar occupancy grid information from the ODS application.
</pre></div>
</div>
</div>
<p>The polar occupancy grid is a compressed representation of the standard occupancy grid using polar coordinates. This grid is an array of 675 elements, each representing a specific direction around the vehicle.</p>
<p>Each index corresponds to an angular slice:</p>
<ul class="simple">
<li><p>index <code class="docutils literal notranslate"><span class="pre">i</span></code> represents the direction from <code class="docutils literal notranslate"><span class="pre">i*(360°</span> <span class="pre">/</span> <span class="pre">675)</span></code> to <code class="docutils literal notranslate"><span class="pre">(i</span> <span class="pre">+</span> <span class="pre">1)*(360°</span> <span class="pre">/</span> <span class="pre">675)</span></code>.</p></li>
<li><p>This angle is determined using <code class="docutils literal notranslate"><span class="pre">atan2(ry,</span> <span class="pre">rx)</span></code>, where <code class="docutils literal notranslate"><span class="pre">(rx,</span> <span class="pre">ry)</span></code> is the ray direction.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The polar occupancy grid origin is always at user coordinates (0,0)
</pre></div>
</div>
</div>
<p>The value at each index represents the distance to the nearest occupied cell (obstacle) along the corresponding direction, measured in millimeters (mm). If no obstacle is detected along the ray then the value is set to 65535 (indicating an unlimited range).</p>
<!-- TODO: ADD IMAGE OF POLAR OCCUPANCY GRID -->
<p>These grids serve as an input for path planning, obstacle avoidance, and environment mapping applications.</p>
</section>
<section id="range-of-interest">
<h2>Range of Interest<a class="headerlink" href="#range-of-interest" title="Link to this heading"></a></h2>
<p>The default occupancy grid size is 10 x 10 m<sup>2</sup> with the calibrated reference coordinate system (RCS) positioned at the center of grid with X-range&lt;=5 meters.</p>
<p>If large vehicles are used for ODS with translation offsets &gt; 1.5 m with respect to the RCS, the occupancy grid size is limiting the detection range of ODS. The detection range on large objects is close to 4 m, which would get clipped by the available 3.5 m range in occupancy grid.</p>
<p>To address this issue, from firmware versions &gt;= 1.10.13 a new parameter is introduced, <code class="docutils literal notranslate"><span class="pre">rangeOfInterest</span></code>, within the <code class="docutils literal notranslate"><span class="pre">grid</span></code> configuration. This parameter allows users to extend the grid size to accommodate larger translation offsets, ensuring optimal performance of the ODS in such scenarios.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rangeOfInterest</span></code> parameter directly affects the occupancy grid’s dimensions. The grid always maintains a square shape with default resolution of 5cm per cell i.e. 0.05m. Therefore the occupancy grid size is calculated as:</p>
<!-- 
$$
\text{grid size} = \left(\frac{\text{rangeOfInterest}}{0.05}\right) \times 2
$$ -->
<p><img alt="RoI_formula" src="../../_images/range_of_interest_formula.png" /></p>
<p>If <code class="docutils literal notranslate"><span class="pre">rangeOfInterest</span></code> is <strong>7</strong>, then the resultant occupancy grid shape is (280,280).</p>
</section>
<section id="ods-application-outputs">
<h2>ODS application outputs<a class="headerlink" href="#ods-application-outputs" title="Link to this heading"></a></h2>
<p>From the ifm3d API versions &gt;= 1.6.6, the user is able to retrieve both standard occupancy grid and polar occupancy grid information from the application interface.</p>
<p>To retrieve the standard occupancy grid, please use <code class="docutils literal notranslate"><span class="pre">ODSOccupancyGridV1</span></code> class in ifm3d API. For more information please visit <a class="reference external" href="https://api.ifm3d.com">ifm3d API documentation</a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">timestamp_ns</span></code></p></td>
<td><p>uint64</p></td>
<td><p>timestamp of occupancy grid in nanoseconds - NTP time if NTP server is synchronized</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">width</span></code></p></td>
<td><p>uint16</p></td>
<td><p>number of grid cells - width (x)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">height</span></code></p></td>
<td><p>uint16</p></td>
<td><p>number of grid cells - height (y)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">transformCellCenterToUser</span></code></p></td>
<td><p>float[6]</p></td>
<td><p>used for affine mapping between occupancy grid cells and user coordinate system</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">image</span></code></p></td>
<td><p>uint8[<code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code>]</p></td>
<td><p>uint8 array of width x height pixels; 0: object probability is 0; 255: object probability is 1</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The occupancy grid information is generated by processing the data from all active cameras.</p></li>
<li><p>The reference coordinate system is located at the center of the occupancy grid i.e. [100,100] in standard occupancy grid image.</p></li>
</ul>
</div>
<p>To retrieve the polar occupancy grid, please use <code class="docutils literal notranslate"><span class="pre">ODSPolarOccupancyGridV1</span></code> class in ifm3d API. For more information please visit <a class="reference external" href="https://api.ifm3d.com">ifm3d API documentation</a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">version</span></code></p></td>
<td><p>uint32</p></td>
<td><p>version of the grid</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">timestamp_ns</span></code></p></td>
<td><p>uint64</p></td>
<td><p>timestamp of the grid</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">polarOccGrid</span></code></p></td>
<td><p>uint16[675]</p></td>
<td><p>A compressed version of the grid using polar coordinates.</p></td>
</tr>
</tbody>
</table>
<section id="transformcellcentertouser-transformation-parameters">
<h3>transformCellCenterToUser - transformation parameters<a class="headerlink" href="#transformcellcentertouser-transformation-parameters" title="Link to this heading"></a></h3>
<p>This information helps the user to convert grid-based cell coordinates (used in occupancy grids) into real-world user coordinates (e.g., in meters). This is especially useful when interpreting map data or visualizing positions on an occupancy grid.</p>
<p>The user can retrieve this information by deserializing the buffer received from buffer_id <code class="docutils literal notranslate"><span class="pre">O3R_ODS_OCCUPANCY_GRID</span></code>. The transformation can be achieved by multiplying the <code class="docutils literal notranslate"><span class="pre">transformCellCenterToUser</span></code> and <code class="docutils literal notranslate"><span class="pre">grid</span> <span class="pre">based</span> <span class="pre">cell</span> <span class="pre">coordinates</span></code></p>
<p><img alt="transformCellCenterToUser" src="../../_images/transformCellCenterToUser.png" /></p>
<p>For more details on the mathematical relation, that is transformation chains, please see the example code below:</p>
</section>
</section>
</section>


           </div>
          </div>
          
<html>
<head>
 
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="keywords" content="footer, address, phone, icons" />
 
	<title>Footer With Address And Phones</title>
	
	
 
</head>
 
	<body>
		
		<footer class="footer-distributed">
 
		<div class="footer-left">
 
		<p class="footer-links">
		<a href="index.html">Home</a>
	·
		<a href="http://www.o3r.ifm" target="_blank">Learn more</a>
	·
		<a href="/latest/_static/privacy-policy.html" target="_blank">Privacy Policy</a>

		</p>
 
		<p class="footer-company-name">ifm robotics &copy; 2023</p>
		</div>
		
		<div class="footer-center">
 
		<div>
		<i class="fa fa-envelope"></i>
		<p><a href="mailto:support.efector.object-ident@ifm.com">support.efector.object-ident@ifm.com</a></p>
		</div>
 
		</div>
 
		<div class="footer-right">
 
		<div class="footer-icons">
 
		<a href="https://www.facebook.com/ifmefector" target="_blank"><i class="fa fa-facebook"></i></a>
		<a href="https://twitter.com/ifm_USA" target="_blank"><i class="fa fa-twitter"></i></a>
		<a href="https://www.linkedin.com/showcase/ifm-efector" target="_blank"><i class="fa fa-linkedin"></i></a>
		<a href="https://github.com/ifm" target="_blank"><i class="fa fa-github"></i></a>
 
		</div>
 
		</div>
 
		</footer>
 
	</body>
 
</html>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>