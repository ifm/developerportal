<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZZ08KXKV1G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZZ08KXKV1G');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ODS Performance evaluation &mdash; O3R  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/js/versionwarning.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="ODS Performance" href="../PerformanceBenchmark/ods_performance_benchmark.html" />
    <link rel="prev" title="ODS performance" href="../index_field_test.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> O3R
          </a>
              <div class="version">
                v1.1.30
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GettingStarted/index_getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Firmware/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CompatibilityMatrix/compatibility_matrix.html">Compatibility Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Technology/index_hardware_interfaces.html">Technology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index_software_interfaces.html">Software Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index_ods.html">ODS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Mounting/mounting.html">Mounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Instantiation/instantiation.html">Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Configuration/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Zones/zones.html">Zones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../OccupancyGrid/occupancy_grid.html">Occupancy grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Recording/ods_data_recording.html">Recording</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangingViews/changing_views.html">Changing views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../OverhangingLoads/overhanging_loads.html">Overhanging loads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../NegativeObstacles/negative_obstacles.html">Negative Obstacles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../DustMitigation/dust_mitigation.html">Dust artifact mitigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ExtrinsicCalibration/index_extrinsic_calibration.html">Extrinsic calibration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index_field_test.html">Field test</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Performance evaluation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ods-performance-analysis">ODS Performance analysis</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#how-to-read-the-data">How to read the data</a></li>
<li class="toctree-l5"><a class="reference internal" href="#how-to-analyze-the-data">How to analyze the data</a></li>
<li class="toctree-l5"><a class="reference internal" href="#false-positive-evaluation">False positive evaluation</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#output"><strong>Output</strong></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../PerformanceBenchmark/ods_performance_benchmark.html">Performance benchmark</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TOFArtifacts/ods_tof_artifacts.html">Time-of-flight artifacts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../DeviceVerification/index_device_verification.html">Device verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iVA/index_ifmODS_iVA.html">ifmVisionAssistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Python/index_ifmODS_python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Cpp/index_ifmODS_cpp.html">C++</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ/FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../downloadable/index.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">O3R</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index_ods.html">ODS (Obstacle Detection System)</a> &raquo;</li>
          <li><a href="../index_field_test.html">ODS performance</a> &raquo;</li>
      <li>ODS Performance evaluation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/ODS/FieldTest/PerformanceVerification/ods_performance_verification.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="tex2jax_ignore mathjax_ignore section" id="ods-performance-evaluation">
<h1>ODS Performance evaluation<a class="headerlink" href="#ods-performance-evaluation" title="Permalink to this headline"></a></h1>
<p>The O3R-ODS performance for an AGV depends upon various factors. This whitepaper gives presents a evaluation strategy for benchmarking</p>
<div class="section" id="ods-performance-analysis">
<h2>ODS Performance analysis<a class="headerlink" href="#ods-performance-analysis" title="Permalink to this headline"></a></h2>
<div class="section" id="how-to-read-the-data">
<h3>How to read the data<a class="headerlink" href="#how-to-read-the-data" title="Permalink to this headline"></a></h3>
<p>Please refer to the <a class="reference internal" href="../../Recording/ods_data_recording.html#ifmvisionassistant"><span class="std std-doc">iVA ODS recording documentation</span></a> to find out more details on how to record and import our open source hdf5 data files.</p>
</div>
<hr class="docutils" />
<div class="section" id="how-to-analyze-the-data">
<h3>How to analyze the data<a class="headerlink" href="#how-to-analyze-the-data" title="Permalink to this headline"></a></h3>
<p><strong>At which frame the object is detected</strong></p>
<p>The code snippet below serves as an example to analyze the data recorded during a robots parkour run.
The following code snippet analyzes the True Positive Test case i.e the maximum distance between the vehicle and the object when it is detected by the ODS system.</p>
<p><strong>Test Scenario:</strong></p>
<ul class="simple">
<li><p>Place an object of interest at a distance of 5 m - 7 m from the robot: that is enough free space wo an object in front of the camera</p></li>
<li><p>Launch the ODS application instance via ifm Vision Assistant (iVA)</p></li>
<li><p>and start recording</p></li>
<li><p>Driving the robot towards the object at the desired speed: testing multiple speeds, especially for smaller objects close to the floor might be beneficial for understanding the ODS performance limits.</p></li>
</ul>
<p><strong>Test Scenario</strong></p>
<p><img alt="Test scenario" src="../../../_images/test_scenario_edited.png" /></p>
<p><strong>Camera Mounting Height</strong></p>
<p>This is an exemplary test case: please see the mounting guide for suggested mounting positions and heights.</p>
<p><img alt="Camera Mounting" src="../../../_images/camera_mounting.png" /></p>
<p>Below you can find an exemplary output of data as streamed and displayed using the iVA.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>RGB STREAM</p></th>
<th class="head"><p>ODS STREAM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img alt="RGB stream" src="../../../_images/rgb_stream.gif" /></p></td>
<td><p><img alt="ODS stream" src="../../../_images/ods_stream.gif" /></p></td>
</tr>
</tbody>
</table>
<p><strong>Question:</strong></p>
<p>In the recorded data, at which frame does ODS detect the obstacle. Provide the distance from user coordinate-system origin (that is robot location) to the object.
Please find the script to reproduce the following images from the recorded data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## create a distance map based on the recorded data occupancy grid data</span>

<span class="k">def</span> <span class="nf">get_distance_map_data</span><span class="p">(</span><span class="n">stream_ods</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Input: ODS data stream</span>
<span class="sd">    Output: Distance Map (Time vs Distance), Frames where the Object is detected in ROI</span>
<span class="sd">    This function reads the ods data stream from recorded data and</span>
<span class="sd">    outputs an image</span>
<span class="sd">        - where each column represents the each occupancy grid in a stream</span>
<span class="sd">        - Each row in a column of distance map represents the first non-zero value</span>
<span class="sd">                (if exists) along the each row in a Occupancy Grid</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#  Array of all Occupancy grids in a stream_ods</span>
    <span class="n">occupancy_grids_array</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stream_ods</span><span class="p">[:][</span><span class="s1">&#39;image&#39;</span><span class="p">])</span>
    <span class="n">total_occupancy_grids</span>   <span class="o">=</span> <span class="n">occupancy_grids_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">rows_in_occupancy_grid</span>  <span class="o">=</span> <span class="n">occupancy_grids_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#  We are interested in frame when the object is detected in ROI</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">distance_map</span>            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">occupancy_grids</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">occupancy_grid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_occupancy_grids</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows_in_occupancy_grid</span><span class="p">):</span>

            <span class="c1"># check for  a non-zero value in each row</span>
            <span class="n">idx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">occupancy_grids_array</span><span class="p">[</span><span class="n">occupancy_grid</span><span class="p">,</span><span class="n">row</span><span class="p">,:]</span><span class="o">&gt;</span><span class="mi">127</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># No non-zero value found in a row of occupancy grid</span>
                <span class="n">distance_map</span><span class="p">[</span><span class="n">occupancy_grid</span><span class="p">,</span><span class="n">row</span><span class="p">]</span><span class="o">=</span><span class="mi">200</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">distance_map</span><span class="p">[</span><span class="n">occupancy_grid</span><span class="p">,</span><span class="n">row</span><span class="p">]</span><span class="o">=</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="mi">85</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;=</span> <span class="mi">115</span><span class="p">):</span> <span class="c1"># ROI is considered as 85 to 115 rows in occupancy grid</span>
                    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occupancy_grid</span><span class="p">)</span>

    <span class="n">distance_map</span>    <span class="o">=</span> <span class="o">-</span><span class="n">distance_map</span>

    <span class="k">return</span> <span class="n">distance_map</span>


<span class="n">distance_map</span> <span class="o">=</span> <span class="n">get_distance_map_data</span><span class="p">(</span><span class="n">stream_ods</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">distance_map</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="c1"># Plot ROI</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Distance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distance Map of Recorded Data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>Output:</strong></p>
</div>
<div class="section" id="false-positive-evaluation">
<h3>False positive evaluation<a class="headerlink" href="#false-positive-evaluation" title="Permalink to this headline"></a></h3>
<p><img alt="Distance map output" src="../../../_images/distance_map.png" /></p>
<p>Above the distance map representation of the recorded ODS data is show.</p>
<p>This distance map is a representation of closest non zero distance per occupancy grid row (that is movement direction) over time. This representation takes a bit of time to get used to but gives a compact representation of object distance as color information over time per geometric Y-location.</p>
<p>If high color differences (for example “color contrasts”) appear, this is equivalent to quick change of object distance at that location. Non-continuous color changes indicate that the detected object distance changes quickly over frame counter, i.e:</p>
<ul class="simple">
<li><p>the object detection was “just picked up on”</p></li>
<li><p>the object detection was lost, for example the object left the field of view</p></li>
<li><p>the object might not be a true positive, but a false positive, for example a point cloud or occupancy grid artifact</p></li>
</ul>
<p><strong>Example evaluation of this distance map and occupancy grid</strong></p>
<p>From output above, we can say that the object started to appear in the occupancy grid from frames between 125 to 140. We see there are no non-zero values in the Region of Interest (<code class="docutils literal notranslate"><span class="pre">ROI</span></code>) until the obstacle is detected and this can deduce that there are no false positives detected in the data. The following snippet plots the 16 occupancy grids (8 Occupancy grids before and after object detection in <code class="docutils literal notranslate"><span class="pre">ROI</span></code>)</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># create an empty figure object</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">range_occ_grids</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="n">range_occ_grids</span><span class="p">):</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stream_ods</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="s1">&#39;image&#39;</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">frame</span> <span class="o">==</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Object detected in frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="output">
<h2><strong>Output</strong><a class="headerlink" href="#output" title="Permalink to this headline"></a></h2>
<p><img alt="ODS object distance tracking" src="../../../_images/distance_tracker.png" /></p>
<p>The following script shows how to track the distance between the User-Coordinate-System and first object detected in ROI.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################</span>
<span class="c1"># Copyright 2021-present ifm electronic, gmbh</span>
<span class="c1"># SPDX-License-Identifier: Apache-2.0</span>
<span class="c1">#############################################</span>

<span class="c1"># %% Import Libraries</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PosixPath</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">ConvexHull</span>
<span class="kn">import</span> <span class="nn">skimage.measure</span>
<span class="kn">import</span> <span class="nn">skimage.color</span>
<span class="kn">import</span> <span class="nn">skimage.filters</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="c1"># %%</span>


<span class="k">def</span> <span class="nf">get_data_from_h5</span><span class="p">(</span><span class="n">filepath</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>

    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">streams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;available streams: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">stream_2d_left</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="s2">&quot;o3r_rgb_0&quot;</span><span class="p">]</span>
        <span class="n">stream_2d_right</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="s2">&quot;o3r_rgb_1&quot;</span><span class="p">]</span>
        <span class="n">stream_3d_left</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="s2">&quot;o3r_tof_0&quot;</span><span class="p">]</span>
        <span class="n">stream_3d_right</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="s2">&quot;o3r_tof_1&quot;</span><span class="p">]</span>
        <span class="n">stream_ods</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="s2">&quot;o3r_app_ods_0&quot;</span><span class="p">]</span>

        <span class="n">data_2d_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stream_2d_left</span><span class="p">)</span>
        <span class="n">data_2d_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stream_2d_right</span><span class="p">)</span>
        <span class="n">data_3d_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stream_3d_left</span><span class="p">)</span>
        <span class="n">data_3d_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stream_3d_right</span><span class="p">)</span>
        <span class="n">data_ods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stream_ods</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stream: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;stream content: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;streams&#39;</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_2d_left</span><span class="p">,</span> <span class="n">data_2d_right</span><span class="p">,</span> <span class="n">data_3d_left</span><span class="p">,</span> <span class="n">data_3d_right</span><span class="p">,</span> <span class="n">data_ods</span>


<span class="k">def</span> <span class="nf">get_distance_map_data</span><span class="p">(</span><span class="n">data_ods</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">roi</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">115</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the distance map of a recorded iVA dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        stream_ods (np.ndarray): input data stream ODS</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: &#39;time vs distance&#39; of a recorded data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_ods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_ods</span><span class="p">[:][</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>
    <span class="n">total_occupancy_grids</span> <span class="o">=</span> <span class="n">data_ods</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rows_in_occupancy_grid</span> <span class="o">=</span> <span class="n">data_ods</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#  We are interested in the frames where the object is detected inside in ROI</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">distance_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">data_ods</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">occupancy_grid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_occupancy_grids</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows_in_occupancy_grid</span><span class="p">):</span>

            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">data_ods</span><span class="p">[</span><span class="n">occupancy_grid</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)[</span>
                <span class="mi">0</span>
            <span class="p">]</span>  <span class="c1"># non-zero values per row</span>

            <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Non non-zero value found in a row of occupancy grid</span>
                <span class="n">distance_map</span><span class="p">[</span><span class="n">occupancy_grid</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">distance_map</span><span class="p">[</span><span class="n">occupancy_grid</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">row</span> <span class="o">&lt;=</span> <span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">):</span>  <span class="c1"># ROI is considered as 85 to 115 rows in occupancy grid</span>
                    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occupancy_grid</span><span class="p">)</span>

    <span class="n">distance_map</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance_map</span>  <span class="c1"># invert map</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">frames</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">distance_map</span><span class="p">,</span> <span class="n">frames</span>


<span class="k">def</span> <span class="nf">connected_components</span><span class="p">(</span><span class="n">gray_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;evaluate the connected components on a gray scale image</span>

<span class="sd">    Args:</span>
<span class="sd">        gray_image (np.ndarray): input image</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: label images and counter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">binary_mask</span> <span class="o">=</span> <span class="n">gray_image</span> <span class="o">&gt;</span> <span class="mi">127</span>
    <span class="n">labeled_image</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">binary_mask</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">labeled_image</span><span class="p">,</span> <span class="n">count</span>


<span class="k">def</span> <span class="nf">get_obj_pos</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span>
    <span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">hull</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x_coord</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_coord</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x_coord</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_coord</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">coords</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">y_coord</span>
                <span class="p">):</span>  <span class="c1"># check difference in y coordinates only not Euclidean distance</span>
                    <span class="n">x_coord</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y_coord</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span>


<span class="k">def</span> <span class="nf">distance_tracker</span><span class="p">(</span><span class="n">data_ods</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">roi</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">85</span><span class="p">,</span> <span class="mi">115</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distance from user coordinate frame origin to the first object detected in ROI vs Time</span>

<span class="sd">    Args:</span>
<span class="sd">        data_ods (np.ndarray): input data stream ODS</span>
<span class="sd">        frames (list): frames where object is detected in ROI</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: list of frames, coordinates of nearest object of interest</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">check_bbox</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">check_centroid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">frame_detected</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">occ_frame</span> <span class="o">=</span> <span class="n">data_ods</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>
        <span class="n">labeled_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">connected_components</span><span class="p">(</span><span class="n">occ_frame</span><span class="p">)</span>
        <span class="n">object_features</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">labeled_image</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">object_features</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">check_bbox</span><span class="p">:</span>
                <span class="c1"># (min_row, min_col, max_row, max_col)</span>
                <span class="c1"># https://scikit-image.org/docs/stable/api/skimage.measure.html#skimage.measure.regionprops</span>

                <span class="n">min_row</span><span class="p">,</span> <span class="n">min_col</span><span class="p">,</span> <span class="n">max_row</span><span class="p">,</span> <span class="n">max_col</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">min_row</span> <span class="o">&gt;</span> <span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">max_row</span> <span class="o">&lt;</span> <span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># bbox inside the roi</span>
                    <span class="n">frame_detected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">=</span> <span class="n">get_obj_pos</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">check_centroid</span><span class="p">:</span>
                <span class="n">c_row</span><span class="p">,</span> <span class="n">c_col</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;centroid&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">c_row</span> <span class="o">&lt;</span> <span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># centroid inside the roi</span>
                    <span class="n">frame_detected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span> <span class="o">=</span> <span class="n">get_obj_pos</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">frame_detected</span><span class="p">,</span> <span class="n">coordinates</span>


<span class="c1"># %%</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;skimage&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

    <span class="n">FILENAME</span> <span class="o">=</span> <span class="s2">&quot;8. pallet_jack_105deg.h5&quot;</span>
    <span class="n">FILEPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/path/to/local/file/directory/&quot;</span><span class="p">)</span>
    <span class="n">FP</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">FILEPATH</span><span class="p">,</span> <span class="n">FILENAME</span><span class="p">)</span>

    <span class="p">(</span>
        <span class="n">data_2d_left</span><span class="p">,</span>
        <span class="n">data_2d_right</span><span class="p">,</span>
        <span class="n">data_3d_left</span><span class="p">,</span>
        <span class="n">data_3d_right</span><span class="p">,</span>
        <span class="n">data_ods</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="n">get_data_from_h5</span><span class="p">(</span><span class="n">FP</span><span class="p">)</span>
    <span class="n">distance_map</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="n">get_distance_map_data</span><span class="p">(</span><span class="n">data_ods</span><span class="p">)</span>

    <span class="c1"># Plot the distance map</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">distance_map</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frame counter #frame&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y-coordinates in occ pixel space&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distance Map of Recorded Data&quot;</span><span class="p">)</span>

    <span class="c1"># Plot a selection of occupancy grids before and after the detection</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">range_occ_grids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">range_occ_grids</span><span class="p">):</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_ods</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="o">==</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object detected in frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Distance Tracker</span>
    <span class="n">frame_detected</span><span class="p">,</span> <span class="n">coordinates</span> <span class="o">=</span> <span class="n">distance_tracker</span><span class="p">(</span><span class="n">data_ods</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span>
    <span class="n">trans_x</span><span class="p">,</span> <span class="n">trans_y</span><span class="p">,</span> <span class="n">trans_z</span> <span class="o">=</span> <span class="n">data_3d_right</span><span class="p">[</span><span class="s2">&quot;extrinsicOpticToUserTrans&quot;</span><span class="p">][</span>
        <span class="mi">0</span>
    <span class="p">]</span>  <span class="c1"># get extrinsic calibration values</span>

    <span class="n">user_origin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
    <span class="n">trans_x_grid_space</span> <span class="o">=</span> <span class="p">(</span><span class="n">trans_x</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span>
    <span class="n">trans_y_grid_space</span> <span class="o">=</span> <span class="p">(</span><span class="n">trans_y</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span>

    <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">user_origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">trans_y_grid_space</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">user_origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">trans_x_grid_space</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span>
    <span class="p">)</span>  <span class="c1"># smooth distance information</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">301</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">frame_detected</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">d</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;b+&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_ods</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;frame counter&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Distance in mm&quot;</span><span class="p">)</span>
    <span class="n">dist_y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">*</span> <span class="mi">50</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;detected object: distance tracking over time</span><span class="se">\n</span><span class="s2"> maximum distance: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">dist_y_max</span><span class="p">)</span><span class="si">}</span><span class="s2"> mm&quot;</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">166</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_ods</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]][</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">,</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">frame_detected</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;frame </span><span class="si">{</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="c1"># %%</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          
<html>
<head>
 
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="keywords" content="footer, address, phone, icons" />
 
	<title>Footer With Address And Phones</title>
	
	
 
</head>
 
	<body>
		
		<footer class="footer-distributed">
 
		<div class="footer-left">
 
		<p class="footer-links">
		<a href="index.html">Home</a>
	·
		<a href="http://www.o3r.ifm" target="_blank">Learn more</a>
	·
		<a href="../_static/privacy-policy.html" target="_blank">Privacy Policy</a>

		</p>
 
		<p class="footer-company-name">ifm robotics &copy; 2023</p>
		</div>
 
		<div class="footer-center">
 
		<div>
		<i class="fa fa-envelope"></i>
		<p><a href="mailto:support.robotics@ifm.com">support.robotics@ifm.com</a></p>
		</div>
 
		</div>
 
		<div class="footer-right">
 
		<div class="footer-icons">
 
		<a href="https://www.facebook.com/ifmefector" target="_blank"><i class="fa fa-facebook"></i></a>
		<a href="https://twitter.com/ifm_USA" target="_blank"><i class="fa fa-twitter"></i></a>
		<a href="https://www.linkedin.com/showcase/ifm-efector" target="_blank"><i class="fa fa-linkedin"></i></a>
		<a href="https://github.com/ifm" target="_blank"><i class="fa fa-github"></i></a>
 
		</div>
 
		</div>
 
		</footer>
 
	</body>
 
</html>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>