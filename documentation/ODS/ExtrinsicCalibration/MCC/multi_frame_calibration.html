<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZZ08KXKV1G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZZ08KXKV1G');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automated camera head calibration tools &mdash; O3R  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script src="../../../../_static/js/versionwarning.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="How to verify the extrinsic calibration" href="../CameraCalibrationVerification/extrinsic_calibration_verification.html" />
    <link rel="prev" title="Extrinsic calibration for ODS" href="../index_extrinsic_calibration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> O3R
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../GettingStarted/index_getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Firmware/index.html">Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Technology/index_hardware_interfaces.html">Technology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../index_software_interfaces.html">Software Interfaces</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index_ods.html">ODS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Mounting/mounting.html">Mounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Instantiation/instantiation.html">Instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Configuration/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Zones/zones.html">Zones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../OccupancyGrid/occupancy_grid.html">Occupancy grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Recording/ods_data_recording.html">Recording</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangingViews/changing_views.html">Changing views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../OverhangingLoads/overhanging_loads.html">Overhanging loads</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index_extrinsic_calibration.html">Extrinsic calibration</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Automated camera head calibration tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#motion-camera-calibration">Motion Camera Calibration</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l5"><a class="reference internal" href="#tool-description">Tool Description</a></li>
<li class="toctree-l5"><a class="reference internal" href="#procedure">Procedure</a></li>
<li class="toctree-l5"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../CameraCalibrationVerification/extrinsic_calibration_verification.html">How to verify the extrinsic calibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../VPUCalibration/README.html">VPU extrinsic calibration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../FieldTest/index_field_test.html">Field test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../DeviceVerification/index_device_verification.html">Device verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iVA/index_ifmODS_iVA.html">ifmVisionAssistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Python/index_ifmODS_python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Cpp/index_ifmODS_cpp.html">C++</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ/FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../downloadable/index.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">O3R</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index_ods.html">ODS (Obstacle Detection System)</a> &raquo;</li>
          <li><a href="../index_extrinsic_calibration.html">Extrinsic calibration for ODS</a> &raquo;</li>
      <li>Automated camera head calibration tools</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/documentation/ODS/ExtrinsicCalibration/MCC/multi_frame_calibration.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="tex2jax_ignore mathjax_ignore section" id="automated-camera-head-calibration-tools">
<h1>Automated camera head calibration tools<a class="headerlink" href="#automated-camera-head-calibration-tools" title="Permalink to this headline"></a></h1>
<p>Camera calibration tools and tactics can change depending on the needs of the application.</p>
<p>ifm provides <span class="xref myst">python code samples</span> to facilitate calibration using a stationary checkerboard. This process can be used to build calibration cells for end-of-line testing of AMRs/AGVs camera systems.</p>
<p>When developing an AMR and testing the camera system, the static calibration methodology requires repeated measurements with each repositioning of the vehicle. An alternate tool was built to address the need for field-testing of cameras. This tool is called Motion Camera Calibration (MCC).</p>
<div class="section" id="motion-camera-calibration">
<h2>Motion Camera Calibration<a class="headerlink" href="#motion-camera-calibration" title="Permalink to this headline"></a></h2>
<p>The MCC tool allows the roboticist to perform camera calibration by moving the vehicle to which the camera is attached.</p>
<p>The application will use the images that the camera collects while the vehicle is moving to determine the 3 rotation parameters of the camera’s extrinsic calibration.</p>
<p>Prerequisites:</p>
<ul class="simple">
<li><p>An o3r camera system mounted on a vehicle.</p></li>
<li><p>A vehicle which can travel in a straight line in the negative-x direction (backward).</p></li>
<li><p>A computer connected to the VPU of the o3r camera system.</p></li>
<li><p>Measurements of the translations of the camera head (transX, transY, and transZ of the extrinsicHeadToUser properties). This can be measured manually, or derived from CAD. Note that the camera positions are relative to the center of the rear face of the camera head.</p></li>
</ul>
<!-- TODO: ADD link to image -->
<ul class="simple">
<li><p>The Motion Camera Calibration software package. Currently, this is available upon request from support.robotics&#64;ifm.com.</p></li>
<li><p>A printed calibration checkerboard (checkerboard.pdf in 0.8m x 0.6m) resting on the floor or at a height so that it is in the field of view of the camera being calibrated.
Please find the checkerboard in pdf format <a class="reference download internal" download="" href="../../../../_downloads/25aa6332b6e1553e890772cebb09284a/MotionCameraCalibrationTarget_600X800.pdf"><code class="xref download docutils literal notranslate"> <span class="pre">here</span></code></a></p></li>
</ul>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline"></a></h3>
<p>We recommend installing the MCC tool to a fresh Python3 venv to minimize the risk of conflicting versions of dependent Python libraries.</p>
<ol>
<li><p>Create a new venv:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">venv</span>
</pre></div>
</div>
</li>
<li><p>Install the requirements: The required <code class="docutils literal notranslate"><span class="pre">requirements_MCC.txt</span></code> file can be found in the GH repository under <code class="docutils literal notranslate"><span class="pre">ODS/ExtrinsicCalibration/MCC</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">./</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements_MCC</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</li>
<li><p>Install the MCC tool: request the download link via email from: from support.robotics&#64;ifm.com</p></li>
<li><p>Start the MCC tool:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">o3r</span><span class="o">-</span><span class="n">extr</span><span class="o">-</span><span class="n">calib</span><span class="o">-</span><span class="n">camera</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="tool-description">
<h3>Tool Description<a class="headerlink" href="#tool-description" title="Permalink to this headline"></a></h3>
<ol class="simple">
<li><p>The MCC application window has 2 parts. <!-- TODO: add UI picture --></p>
<ol class="simple">
<li><p>On the left side, you can:</p>
<ul class="simple">
<li><p>Conﬁgure:</p>
<ul>
<li><p>The ports</p></li>
<li><p>The modes</p></li>
<li><p>The cell size of the checkerboard</p></li>
<li><p>The translation parameters</p></li>
</ul>
</li>
<li><p>Start backward motion / stop backward motion</p></li>
<li><p>Clear and restart the calibration process</p></li>
<li><p>Save / load the data ﬁle</p></li>
</ul>
</li>
<li><p>On the right side, you have two windows:</p>
<ul class="simple">
<li><p>Left window: shows the live stream of the camera,</p></li>
<li><p>Right window: shows the last image that is used for calibration.</p></li>
</ul>
</li>
</ol>
</li>
<li><p>You can calibrate only one camera at a time; therefore select the camera port in the application window which you wish to calibrate.</p></li>
</ol>
</div>
<div class="section" id="procedure">
<h3>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline"></a></h3>
<ol>
<li><p>Place the target horizontally (if the camera head is mounted horizontally) or vertically (if the camera is mounted vertically) such that the reference corner (bigger cell) is up.</p></li>
<li><p>Type in the camera translations.</p></li>
<li><p>Move the camera closer to the target such that the target is large in the live image: it should at least ﬁll 50% of the image. <!-- TODO: add UI picture --></p></li>
<li><p>Once the checkerboard is detected, the corners will become green indicating that you can start the backward motion.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Start</span> <span class="pre">backward</span> <span class="pre">motion</span></code> and move the robot backward in a straight line.<!-- TODO: add diagram--></p>
<ul class="simple">
<li><p>Once you clicked the <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">backward</span> <span class="pre">motion</span></code> all other options will be greyed out except <code class="docutils literal notranslate"><span class="pre">Clear</span> <span class="pre">and</span> <span class="pre">Restart</span></code></p></li>
<li><p><strong>The minimum movement range should be <code class="docutils literal notranslate"><span class="pre">50</span> <span class="pre">cm</span></code> (If you moved the robot less than 50 cm then the calibration will not be successful)</strong></p></li>
</ul>
<a class="reference internal image-reference" href="../../../../_images/move_back.gif"><img alt="Drive backwards" class="align-center" src="../../../../_images/move_back.gif" style="width: 400px;" /></a>
</li>
<li><p>The calibration tool will automatically save the frames to a file in the background while you move the robot (camera).</p></li>
<li><p>Once the calibration tool captures the required number of frames, the <code class="docutils literal notranslate"><span class="pre">Stop</span> <span class="pre">backward</span> <span class="pre">motion</span></code> button will be enabled again and can be clicked by the user to terminate this step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>During the procedure, if you feel you did anything wrong or didn’t move the camera in a straight line click <code class="docutils literal notranslate"><span class="pre">Clear</span> <span class="pre">and</span> <span class="pre">Restart</span></code> to restart the calibration procedure.</p>
</div>
</li>
<li><p>Move the robot orthogonal to the backward motion line and close to the target (ﬁll at least 50% of the image) such that the tool detects all corners of the checkerboard target.</p>
<ul class="simple">
<li><p>The orthogonal offset should be a minimum of 40 cm.</p></li>
</ul>
<a class="reference internal image-reference" href="../../../../_images/capture_frame_1.gif"><img alt="Capture single frame 1" class="align-center" src="../../../../_images/capture_frame_1.gif" style="width: 400px;" /></a>
</li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">single</span> <span class="pre">image</span> <span class="pre">(1/2)</span></code> to add this image to the calibration data file. After clicking the button once, it changes to <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">single</span> <span class="pre">image</span> <span class="pre">(2/2)</span></code> which means the first offset position was successful.</p></li>
<li><p>Move the camera to the other side of the backward motion line and ensure all the checkerboard corners are detected.</p>
<a class="reference internal image-reference" href="../../../../_images/capture-frame-2.gif"><img alt="Capture single frame 2" class="align-center" src="../../../../_images/capture-frame-2.gif" style="width: 400px;" /></a>
</li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">single</span> <span class="pre">image</span> <span class="pre">(2/2)</span></code>.</p></li>
<li><p>Click <code class="docutils literal notranslate"><span class="pre">Calibrate</span></code> to perform calibration and output the results.</p></li>
<li><p>The calibration status and parameters will be displayed at the top of the application window.</p>
<p><strong>Optional Steps</strong></p>
</li>
<li><p>Manually save the calibration parameters output (values) to a file for further reference.</p></li>
<li><p>Save the image data file by clicking on the <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">h5</span> <span class="pre">file</span></code> button, this is a handy file to send back to ifm development team for debugging.</p></li>
</ol>
</div>
<div class="section" id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h3>
<p>The calibration might not be successful due to the following reasons:</p>
<ul class="simple">
<li><p>Backward motion is not in a straight line.</p></li>
<li><p>If the backward motion path is too short. The minimum path length is 0.4 meters.</p></li>
<li><p>Due to low signal levels in the images. In this case, try calibrating using <code class="docutils literal notranslate"><span class="pre">activeIllumination</span></code> mode.</p></li>
<li><p>If the target is too small in the images. Try to move closer to the checkerboard target.</p></li>
<li><p>If the single images are too close to each other. The offset between the positions of two single images should be at least 0.50 meters.</p></li>
<li><p>If the distance between a single image and the motion path is less than 0.25 meters.</p></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index_extrinsic_calibration.html" class="btn btn-neutral float-left" title="Extrinsic calibration for ODS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../CameraCalibrationVerification/extrinsic_calibration_verification.html" class="btn btn-neutral float-right" title="How to verify the extrinsic calibration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, ifm CSR.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>